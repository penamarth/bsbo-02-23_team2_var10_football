# Диаграмма последовательности: Покупка абонемента

```plantuml
@startuml
title Покупка абонемента

actor "Кассир" as Cashier
participant ":TicketSystemFacade" as Facade
participant ":TicketService" as Service
participant ":Stadium" as Stadium
participant "matches:List<Match>" as Matches
participant ":Seat" as Seat
participant ":PaymentService" as PaymentSvc
participant ":NotificationService" as NotifSvc
participant "seasonTicket:SeasonTicket" as SeasonTicket

activate Cashier

Cashier -> Facade: getSeasonInfo()
activate Facade
Facade --> Cashier: season info (name, matches count)
deactivate Facade

Cashier -> Facade: viewAvailableSeatsForSeason()
activate Facade

Facade -> Service: getSeatsAvailableForAllMatches()
activate Service

Service -> Stadium: getSections()
activate Stadium
Stadium --> Service: sections
deactivate Stadium

Service -> Matches: getAllSeasonMatches()
activate Matches
Matches --> Service: matches
deactivate Matches

loop для каждого места
    Service -> Service: checkAvailabilityForAllMatches(seat, matches)
    note right: Проверка доступности\nместа на все матчи
end

Service --> Facade: availableSeats
deactivate Service

Facade --> Cashier: список доступных мест
deactivate Facade

Cashier -> Cashier: выбор места с покупателем

Cashier -> Facade: buySeasonTicket(season, seatId, customer, paymentMethod)
activate Facade

Facade -> Service: getSeat(seatId)
activate Service
Service --> Facade: seat
deactivate Service

Facade -> Matches: getAllSeasonMatches()
activate Matches
Matches --> Facade: matches
deactivate Matches

Facade -> Facade: calculateSeasonPrice(seat, matchesCount)
note right: Использование Strategy pattern\nБазовая цена × количество матчей\n× коэффициент категории

Facade -> PaymentSvc: processPayment(amount, paymentMethod)
activate PaymentSvc
PaymentSvc --> Facade: payment
deactivate PaymentSvc

alt payment success
    Facade -> Service: createSeasonTicket(season, seat, customer, matches, price)
    activate Service
    
    Service -> SeasonTicket: new SeasonTicket(season, seat, customer, matches, price)
    activate SeasonTicket
    SeasonTicket --> Service: seasonTicket
    deactivate SeasonTicket
    
    loop для каждого матча
        Service -> Seat: reserveForMatch(match)
        activate Seat
        Seat --> Service: void
        deactivate Seat
    end
    
    Service --> Facade: seasonTicket
    deactivate Service
    
    Facade -> NotifSvc: notify("Абонемент продан на место")
    activate NotifSvc
    NotifSvc --> Facade: void
    deactivate NotifSvc
    
    Facade --> Cashier: seasonTicket
else payment failed
    Facade --> Cashier: error("Ошибка оплаты")
end

deactivate Facade

Cashier -> Cashier: печать абонемента
Cashier --> Cashier: выдача абонемента покупателю

deactivate Cashier

@enduml
```
```

### Коммит изменений

```bash
git add "docs/Прецеденты/Покупка абонемента/"
git commit -m "Add use case: Buy Season Ticket"
git push origin main

