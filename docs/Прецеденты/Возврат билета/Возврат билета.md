# Прецедент: Возврат билета

**Рамки.** Система продажи билетов на футбол.

**Уровень.** Задача, определенная пользователем.

**Основной исполнитель.** Кассир.

## Заинтересованные лица и их требования

- **Кассир.** Хочет быстро оформить возврат билета, проверить возможность возврата и выдать деньги покупателю.
- **Покупатель.** Хочет вернуть билет и получить обратно деньги (с учетом комиссии).
- **Система.** Должна проверить возможность возврата (не позднее 24 часов до матча), освободить место, вернуть 90% стоимости и обновить информацию о доступности места.
- **Стадион.** Заинтересован в корректном учете возвращенных билетов и освобождении мест для продажи.

## Предусловия

- Кассир авторизован в системе.
- У покупателя есть билет с уникальным номером.
- Матч еще не состоялся.

## Результаты (Постусловия)

- Билет аннулирован.
- Место освобождено и доступно для продажи.
- Покупателю возвращено 90% стоимости билета.
- Информация о возврате зафиксирована в системе.

## Основной успешный сценарий

1. Покупатель обращается к кассиру с просьбой вернуть билет.
2. Кассир запрашивает номер билета.
3. Покупатель предъявляет билет.
4. Кассир вводит номер билета в систему.
5. Система находит билет по номеру.
6. Система проверяет статус билета (должен быть активным).
7. Система проверяет время до начала матча (должно быть более 24 часов).
8. Система рассчитывает сумму возврата (90% от стоимости билета).
9. Система отображает информацию о билете и сумму возврата.
10. Кассир подтверждает возврат.
11. Система меняет статус билета на "Отменен".
12. Система освобождает место (помечает как доступное).
13. Система регистрирует возврат денег.
14. Кассир выдает деньги покупателю.
15. Система отправляет уведомление другим кассам об освобождении места.

## Расширения (альтернативные потоки)

**5а. Билет с указанным номером не найден.**
1. Система сообщает об ошибке.
2. Кассир просит покупателя проверить номер билета.
3. Процесс повторяется с шага 4.

**6а. Билет уже был возвращен или использован.**
1. Система сообщает, что билет недействителен.
2. Кассир отказывает в возврате.

**7а. До начала матча осталось менее 24 часов.**
1. Система сообщает, что возврат невозможен согласно правилам.
2. Кассир объясняет ситуацию покупателю.
3. Покупатель может оставить билет себе или обратиться к администратору для исключительного случая.

**14а. В кассе недостаточно наличных для возврата.**
1. Кассир предлагает возврат на карту или в другой кассе.
2. Если покупатель согласен - оформляется возврат на карту.

## Специальные требования

- Возврат возможен только за 24+ часов до начала матча.
- Возвращается 90% стоимости билета (10% - комиссия системы).
- Освобожденное место должно немедленно стать доступным для продажи в других кассах.
- Операция возврата должна быть зарегистрирована с указанием даты, времени, кассира и причины.

## Список технологий и типов данных

- Номер билета: string (формат "T-XXXXXXXX").
- Время до матча: вычисляется как разница между DateTime матча и текущим временем.
- Сумма возврата: decimal (90% от исходной стоимости).

## Частота использования

Несколько раз в день.

## Открытые вопросы

- Можно ли вернуть билет, купленный по специальной акции?
- Есть ли исключения для VIP-клиентов (возможность возврата позже)?
