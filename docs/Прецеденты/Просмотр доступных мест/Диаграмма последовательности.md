# Диаграмма последовательности: Просмотр доступных мест

```plantuml
@startuml
title Просмотр доступных мест

actor "Кассир" as Cashier
participant ":TicketSystemFacade" as Facade
participant ":TicketService" as Service
participant ":Stadium" as Stadium
participant ":Match" as Match
participant "sections:List<Section>" as Sections
participant "section:Section" as Section
participant "seats:List<Seat>" as Seats

activate Cashier

Cashier -> Facade: getAllMatches()
activate Facade
Facade --> Cashier: список матчей
deactivate Facade

Cashier -> Cashier: выбор матча покупателем

Cashier -> Facade: viewAvailableSeats(matchId)
activate Facade

Facade -> Service: getMatch(matchId)
activate Service
Service --> Facade: match
deactivate Service

Facade -> Match: getStadium()
activate Match
Match --> Facade: stadium
deactivate Match

Facade -> Stadium: getSections()
activate Stadium
Stadium --> Facade: sections
deactivate Stadium

Facade -> Facade: initializeStatistics()
note right: Инициализация счетчиков:\ntotal, available, sold, reserved

loop для каждого сектора
    Facade -> Section: getSeats()
    activate Section
    Section --> Facade: seats
    deactivate Section
    
    loop для каждого места
        Facade -> Seats: isAvailable()
        activate Seats
        Seats --> Facade: availability
        deactivate Seats
        
        alt available
            Facade -> Facade: availableCount++
            Facade -> Facade: addToAvailableList(seat)
        else reserved
            Facade -> Facade: reservedCount++
        else sold
            Facade -> Facade: soldCount++
        end
        
        Facade -> Facade: totalCount++
    end
end

Facade -> Facade: prepareVisualization()
note right: Подготовка данных для отображения:\n- группировка по секторам\n- применение цветовой схемы\n- расчет процентов заполнения

Facade --> Cashier: схема стадиона + статистика
deactivate Facade

Cashier -> Cashier: отображение схемы покупателю

opt Фильтрация по категории
    Cashier -> Facade: filterByCategory(category)
    activate Facade
    Facade -> Facade: filterSeats(availableSeats, category)
    Facade --> Cashier: отфильтрованный список
    deactivate Facade
end

opt Детализация сектора
    Cashier -> Facade: getSectionDetails(sectionId)
    activate Facade
    Facade -> Section: getSeatsWithDetails()
    activate Section
    Section --> Facade: detailedSeats
    deactivate Section
    Facade --> Cashier: детальная информация о секторе
    deactivate Facade
end

deactivate Cashier

@enduml
